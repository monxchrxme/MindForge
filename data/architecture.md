**–£–ª—å—Ç–∏–º–∞—Ç–∏–≤–Ω—ã–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –î–æ–∫—É–º–µ–Ω—Ç (MindForge Architecture 2.0)**. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –∫–∞–∫ `ARCHITECTURE.md` –∏–ª–∏ `README_DEV.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

***

# üß† MindForge Architecture v2.0 (Agentic Orchestrator)

## 1. –°—É—Ç—å –ü—Ä–æ–µ–∫—Ç–∞
**MindForge** ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–≤–∏–∑–æ–≤ (—Ç–µ—Å—Ç–æ–≤) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Markdown/Obsidian).
–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å: –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–∞—Å—Å–∏–≤–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (–ª–µ–∫—Ü–∏–∏, –∫–æ–¥, —Å—Ç–∞—Ç—å–∏) –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (Active Recall).

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∞–Ω–∞–ª–æ–≥–æ–≤:**
–°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Å–∫–∞—Ä–º–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç LLM". –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ê–≥–µ–Ω—Ç–Ω—É—é –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —ç—Ç–∞–ø–æ–º –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä ("–†–µ—à–∞–ª–∞") —Å–Ω–∞—á–∞–ª–∞ –ø–æ–Ω–∏–º–∞–µ—Ç, *—á—Ç–æ* –ø–µ—Ä–µ–¥ –Ω–∏–º (–∫–æ–¥, —Ç–µ–æ—Ä–∏—è, –º—É—Å–æ—Ä), –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

***

## 2. –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ **Python 3.11+** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM **GigaChat** (SberDevices).

```mermaid
graph TD
    User[CLI / Obsidian Plugin] -->|Input: Note Text| Orchestrator
    
    subgraph "The Brain (Agentic Core)"
        Orchestrator[Orchestrator Agent] -->|1. Analyze| Analyzer[Content Analyzer]
        Orchestrator -->|2. Route| Strategy{Strategy Router}
    end
    
    subgraph "Worker Agents (The Hands)"
        Strategy -->|Theory| Parser[Parser Agent]
        Strategy -->|Code| CodeParser[Code Parser Logic]
        Strategy -->|Direct| QuizAgent
        
        Parser -->|Concepts| FactCheck[FactCheck Agent]
        FactCheck -->|Verified Concepts| QuizAgent[Quiz Agent]
        
        QuizAgent -->|Questions| Critic[Self-Reflection Loop*]
    end
    
    subgraph "Support Services"
        Cache[Cache Manager]
        History[Global History]
        Logger[Logging Service]
    end

    QuizAgent -->|Result JSON| Orchestrator
    Orchestrator -->|Final Output| User
```
*\* Self-Reflection Loop ‚Äî –≤ –ø–ª–∞–Ω–∞—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.*

***

## 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –°–∏—Å—Ç–µ–º—ã (–î–µ—Ç–∞–ª—å–Ω–æ)

### 3.1. OrchestratorAgent (`agents/orchestrator.py`)
**–†–æ–ª—å:** "–ú–æ–∑–≥" –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å—Ç–µ–π—Ç-–º–∞—à–∏–Ω–æ–π.
**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
*   **–ê–Ω–∞–ª–∏–∑ (`_analyze_content`):** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∑–∞–º–µ—Ç–∫–∏ (`THEORY`, `CODE`, `SHORT`, `UNKNOWN`) –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å.
*   **–†–æ—É—Ç–∏–Ω–≥:** –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (`standard`, `code_practice`, `direct_quiz`).
*   **Fallback-–º–µ—Ö–∞–Ω–∏–∑–º:** –ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `standard` –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å (–ø–∞—Ä—Å–µ—Ä –≤–µ—Ä–Ω—É–ª 0 –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `direct_quiz`.
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π:** –°–ª–µ–¥–∏—Ç –∑–∞ –∏—Å—Ç–æ—Ä–∏–µ–π –≤–æ–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è (Global History).

### 3.2. ParserAgent (`agents/parser.py`)
**–†–æ–ª—å:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞–æ—Å–∞. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–º—ã—Å–ª–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã.
**–†–µ–∂–∏–º—ã:**
*   `parse_note`: –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (`Term: Definition`).
*   `parse_code_note`: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ä—ã `Term + Code Snippet` –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Code Practice.

### 3.3. QuizAgent (`agents/quiz.py`)
**–†–æ–ª—å:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
*   **–£–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç–∏–Ω–≥:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.
*   **Direct Mode:** –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Å "—Å—ã—Ä—ã–º" —Ç–µ–∫—Å—Ç–æ–º (–±–µ–∑ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤).
*   **Code Support:** –£–º–µ–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –∫—É—Å–∫–∏ –∫–æ–¥–∞ –≤ –ø–æ–ª–µ `code_context` JSON-–æ—Ç–≤–µ—Ç–∞.
*   **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ñ–µ—Å—Ç–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É JSON, —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (—á–µ—Ä–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤).

### 3.4. FactCheckAgent (`agents/factcheck.py`)
**–†–æ–ª—å:** –§–∏–ª—å—Ç—Ä –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π.
*   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã –Ω–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é LLM (–±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–∫–∞).

### 3.5. ExplainAgent (`agents/explain.py`)
**–†–æ–ª—å:** –ü–µ–¥–∞–≥–æ–≥.
*   –í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è.
*   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏ –º–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫—É—é —Ç–µ—Ö–Ω–∏–∫—É ("–î–≤–æ—Ä–µ—Ü –ø–∞–º—è—Ç–∏").

***

## 4. –ü–æ—Ç–æ–∫–∏ –î–∞–Ω–Ω—ã—Ö (Data Flow)

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: STANDARD (–¢–µ–æ—Ä–∏—è)
1.  **Input:** –î–ª–∏–Ω–Ω–∞—è –ª–µ–∫—Ü–∏—è.
2.  **Analysis:** Type=`THEORY`.
3.  **Parser:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ `[{"term": "...", "definition": "..."}]`.
4.  **FactCheck:** –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫.
5.  **Quiz:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —Ç–∏–ø–∞ "–ß—Ç–æ —Ç–∞–∫–æ–µ X?" –∏–ª–∏ "–í–µ—Ä–Ω–æ –ª–∏, —á—Ç–æ Y?".

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: CODE PRACTICE (–ö–æ–¥)
1.  **Input:** –°–Ω–∏–ø–ø–µ—Ç Python —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞.
2.  **Analysis:** Type=`CODE`.
3.  **Parser:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç `[{"term": "Singleton", "code_snippet": "class Singleton..."}]`.
4.  **Quiz:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏: *"–ß—Ç–æ –≤—ã–≤–µ–¥–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥?", "–ù–∞–π–¥–∏ –æ—à–∏–±–∫—É –≤ —Å—Ç—Ä–æ–∫–µ 3"*. –ö–æ–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ `code_context`.

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: DIRECT QUIZ (–ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ / Fallback)
1.  **Input:** –ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–º–µ—Ç–∫–∞ –∏–ª–∏ "–ø–æ—Ç–æ–∫ —Å–æ–∑–Ω–∞–Ω–∏—è".
2.  **Analysis:** Type=`SHORT` –∏–ª–∏ `Parser` –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ—Ç—É.
3.  **Parser:** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
4.  **Quiz:** –ü–æ–ª—É—á–∞–µ—Ç —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç (`raw_text`) –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å—ã "–ø–æ —Å–º—ã—Å–ª—É –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ".

***

## 5. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫ –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

*   **–Ø–∑—ã–∫:** Python 3.11
*   **LLM:** GigaChat (—á–µ—Ä–µ–∑ `gigachat_client.py` - –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ API).
*   **Cache:** –õ–æ–∫–∞–ª—å–Ω—ã–µ JSON-—Ñ–∞–π–ª—ã (`data/cache/`).
    *   –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤: `verified_<HASH>.json`.
    *   –ò—Å—Ç–æ—Ä–∏—è: `global_quiz_history.json` (—Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏).
*   **CLI:** `argparse` –≤ `main.py` (—Ñ–ª–∞–≥–∏ `-d`, `-m`, `--ignore-history` –∏ —Ç.–¥.).
*   **Logging:** –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (`RotatingFileHandler`), —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `data/logs/`.

## 6. –¢–æ—á–∫–∏ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è (Roadmap)

1.  **Feedback Loop (Critic):** –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–≤–∏–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
2.  **External Tools:** –î–∞—Ç—å `FactCheckAgent` –¥–æ—Å—Ç—É–ø –∫ –ø–æ–∏—Å–∫—É (Wiki/DuckDuckGo).
3.  **Vector DB:** –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π JSON-–∫—ç—à –Ω–∞ ChromaDB –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ç–∞—Ä—ã–º –∑–∞–º–µ—Ç–∫–∞–º.

***
*–î–æ–∫—É–º–µ–Ω—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: 4 –¥–µ–∫–∞–±—Ä—è 2025 –≥.*

–ò—Å—Ç–æ—á–Ω–∏–∫–∏
